import requests
from PIL import Image
import io
import base64
import sys

def getImage(prompt: str):
    payload = {
        "prompt": prompt,
        "steps": 50,
        "restore_faces": True,
        "negative_prompt": "aiart, ai art, yes to ai art, ai, ai generated, ai generated art, ai generated drawing, generated by ai, drawn by ai, ai trained, trained by ai, influenced by artificial intelligence, influenced by ai art, drawn by non humans, image compression, distorted, JPEG artifacts, noisy, shaky, pixelated, unclear, artifacts, low detail, low quality, low resolution, distortion, amateur, low res, low-res, cropped body, cut off, basic, boring, botched, unprofessional, multiple views, draft, failure, fake, image corruption, irregular, uneven, unnatural, contorted, twisted, unappealing, blurry, haze, worst quality, normal quality, bad shadow, poor quality, amateur, tasteless, tacky, lacklustre, simple, plain, grainy, out of focus, fuzzy, cropped, uncentered, out of frame, body out of frame, split image, truncated, disjointed, incoherent, disorganized, jumbled, floating, objects, unreal, deformations, kitsch, unattractive, opaque, boring pose, boring, plain, standard, average, uninventive, derivative, homogenous, uncreative, ineffective, drab, amateur, censor, censored, censor_bar, text, font, ui, error, watermark, username, signature, QR code, bar code, copyright, logos, tattoos, HUD, tiling, label, watermarks, calligraphy, kanji, hanzi, hangul, hanza, chu, nom, latin, arabic, cyrillic, symbols, alphanumeric, unicode, script, artist name, logo, censor, high contrast, low contrast, High pass filter, watermarked, monotone, smooth, blur, vignette, filter, writing, oversaturation, over saturation, over shadow, gaussian, weird colors, weird face, weird fingers, blurred, grain, bad art, black-white, posterization, colour banding, grayscale, monochrome, b&w, oversaturated, black and white, no color, greyscale, poorly drawn, messy drawing, bad proportions, gross proportions, imperfection, dehydrated, misshappen, duplicate, odd, erased, morbid, hideous, smudged, double, clones, twins, same face, repeated person, bad anatomy, anatomical nonsense, malformed, misshaped body, uncoordinated body, unnatural body, long body, liquid body, deformed, mutilated, mutation, mutated, tumor, deformed body, lopsided, mangled, skin defect, disfigured, conjoined, connected, intertwined, hooked, bad body, amputation, siamese, cropped head, bad framing, out of shot, awkward poses, unusual poses, smooth skin, misshapen, gross proportions, poorly drawn face, bad face, fused face, cloned face, big face, long face, dirty face, long neck, warped face, loose face, crooked face, asymetric jaw, asymmetric chin, fake face, deformed face, extra heads, big forehead, head cut off, ugly hair, poorly drawn hair, bad drawn eyes, asymmetric eyes, unaligned eyes, crooked eyes, closed eyes, looking_away, fused eyes, poorly drawn eyes, extra eye, cross eyed, imperfect eyes, cataracts, glaucoma, strabismus, heterochromia, woobly iris, square iris, weird eyes, distorted eyes, deformed glasses, extra eyes, bright blue eyes, cross-eyed, blurry eyes, poorly drawn eyes, fused eyes, blind, bad eyes, ugly eyes, bad drawn nose, fused nose, poorly drawn nose, extra nose, bad mouth, fused mouth, poorly drawn mouth, big mouth, mouth cake, cracked mouth, crooked lips, dirty teeth, yellow teeth, ugly teeth, liquid tongue, colorful tongue, black tongue, bad tongue, crooked teeth, yellow teeth, long teeth, bad teeth, fused ears, bad ears, poorly drawn ears, extra ears, liquid ears, heavy ears, missing ears, asymmetric ears, big ears, ugly ears, bad collarbone, fused collarbone, missing collarbone, liquid collarbone, missing limb, malformed limbs, extra limb, floating limbs, disconnected limbs, extra limb, amputee, extra limbs, different limbs proportions, decapitated limbs, mutated hands, poorly drawn hands, malformed hands, bad hands, fused hands, missing hand, extra hand, mangled hands, more than 1 left hand, more than 1 right hand, less than two hands appearing in the image, cropped hands, thousand hands, mutated hands and fingers, missing hands, distorted hands, deformed hands, imperfect hands, undetailed hands, fused fingers, mutated fingers, (tentacle finger), missing fingers, one hand with more than 5 fingers, disfigured hands, one hand with less than 5 fingers, one hand with more than 5 digit, one hand with less than 5 digit, extra digit, fewer digits, fused digit, missing digit, bad digit, liquid digit, extra fingers, too many fingers, disappearing arms, short arm, missing arms, extra arms, less than two arms appearing in the image, cropped arms, out of frame arms, long arms, deformed arms, short arm, different arms proportions, multiple belly buttons, missing belly button, broken legs, disappearing legs, missing legs, extra legs, more than 2 legs, disappearing thigh, missing thighs, extra thighs, more than 2 thighs, deformed legs, bad thigh gap, missing thigh gap, fused thigh gap, liquid thigh gap, poorly drawn thigh gap, huge calf, disappearing calf, missing calf, extra calf, fused calf, bad knee, extra knee, broken legs, different legs proportions, mutated feet, poorly drawn feet, malformed feet, bad feet, fused feet, missing feet, mangled feet, more than 1 left foot, more than 1 right foot, less than two foot appearing in the image, thousand feet, mutated feet and fingers, missing feet, distorted feet, deformed feet, imperfect feet, undetailed feet, ugly feet, extra foot, long toes, extra shoes, bad shoes, fused shoes, more than two shoes, poorly drawn shoes, fused cloth, poorly drawn cloth, safety panties, safety knickers, dirty panties, fused panties, poorly drawn panties, bad panties, dirty pantie, multiple breasts, fused breasts, bad breasts, huge breasts, poorly drawn breasts, extra breasts, liquid breasts, missing breasts, more than 2 nipples, missing nipples, different nipples, fused nipples, bad nipples, poorly drawn nipples, black nipples, colorful nipples, unnatural nipples, without form nipples, withered nipples, extra nipples, more than two nipples, imperfect nipples, poorly drawn vagina, bad vagina, missing vagina, hidden vagina, poorly drawn cameltoe, poorly drawn clitoris, bad clitoris, missing clitoris, hidden clitoris, animal ears, poorly drawn hairs, fused hairs, bad hairs, bad buttocks, poorly drawn buttocks, fused buttocks, missing buttocks, huge haunch, chibi, child, loli, small person, futa, 3D render, photography, poorly drawn clothes, unrefined clothes" 
    }
    try:
        response = requests.post(url=f'http://127.0.0.1:7860/sdapi/v1/txt2img', json=payload)
    except Exception:
        print("Error")
        return
    response = response.json()

    for i in response['images']:
        image = Image.open(io.BytesIO(base64.b64decode(i.split(",",1)[0])))
        
    image.save('waifu.png')
    print("Success")

getImage(sys.argv[1])